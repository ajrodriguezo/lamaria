<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static', path='/css/stylesdatos.css')}}">
    <title>{{title}}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <header id="page-header">

        <div id="branding">
            <h1 id="site-title">{{title}}</h1>
        </div>

        <div id="mySidebar" class="sidebar">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
            <a href="/LaMaria/home">Inicio</a>
            <a href="/LaMaria/ingresoDatos">Datos</a>
        </div>

        <div id="boton">
            <button class="openbtn" onclick="openNav()">☰</button>  
        </div>

        <script>
            function openNav() {
                document.getElementById("mySidebar").style.width = "250px";
                document.getElementById("boton").style.marginRight= "250px";
            }

            function closeNav() {
                document.getElementById("mySidebar").style.width = "0";
                document.getElementById("boton").style.marginRight= "0";
            }
        </script>

    </header>

    <div style="margin: 20px;">
        <h2>Datos de la semana</h2>
    </div>

    <section style="display: flex; justify-content: space-around; padding: 10px;">

        <div id="datos_semana" style="height: 35px; width: 95%; display: flex; justify-content: space-around;">
            
            <form id="datosForm" method="post" action="/LaMaria/ingresoDatos" style="display: inline-flex; width: 100%; justify-content: space-around; align-items: center;">

                <label for="grsemana">gr acumulados</label>
                <input type="number" id="grsemana" name="grsemana" placeholder="0 gr" min="0" max="100" step="1" required>

                <label for="precioseman">Precio promedio</label>
                <input type="number" id="precioseman" name="precioseman" placeholder="0,0 €" min="0" max="500" step="0.1" required>

                <label for="semana">No. semana</label>
                <input type="number" id="semana" name="semana" placeholder="1 - 20" min="0" max="20" step="1" required>

                <button type="submit" class="my-button" id="guardardatossemana">Guardar Datos</button>
            </form>

            <script>
                // Obtén el botón por su identificador
                var guardarDatosBtn = document.getElementById('guardardatossemana');
        
                // Agrega un event listener para el evento 'click'
                guardarDatosBtn.addEventListener('click', function() {
                    // Puedes agregar tu lógica aquí
                    console.log('Botón clickeado');
                    
                    // También puedes enviar el formulario aquí si lo necesitas
                    document.getElementById('datosForm').submit();
                });
            </script>


        </div>

    </section>

    <section style="display: block; justify-content: space-around; padding: 10px;">

        <div id="finciclo" style=" width: 90%;display: inline-flex; align-items: center; padding: 20px;">
            <label id="fechadefin" style="padding-inline: 20px;">Fecha fin de ciclo: DD/MM/AAAA </label>
            <button id="btnTrueEndpoint2" class="my-button">Finalizar Ciclo</button>
        </div>

        <div id="iniciocilo" style="width: 90%; display:inline-flex; align-items: center; padding: 20px;">
            <label for="start" style="margin-right: 20px; margin-left: 20px;">Inicio de ciclo</label>
            <input type="date" id="fechainicio" name="iniciodeciclo" style="margin-right: 20px;" />
            <button id="btnTrueEndpoint1" class="my-button" style="padding-inline: 20px;">Inicio Ciclo </button>
        </div>

        <div style="margin: 20px;">
            <h2>PDf por ciclo</h2>
        </div>

        <div id="iniciocilo" style="width: 90%; display:inline-flex; align-items: center; padding: 20px;">
            <label for="iniciopdf" style="margin-right: 20px; margin-left: 20px;">Inicio de ciclo</label>
            <input type="date" id="iniciopdf" name="iniciopdf" style="margin-right: 20px;" />

            <label for="finalpdf" style="margin-right: 20px; margin-left: 20px;">Fin de ciclo</label>
            <input type="date" id="finalpdf" name="finalpdf" style="margin-right: 20px;" />

            <button id="btnTrueEndpoint1" class="my-button" style="padding-inline: 20px;">Generar pdf </button>
        </div>
        
        

    <script>
        // Obtener los botones por su identificador
        var btnTrueEndpoint1 = document.getElementById('btnTrueEndpoint1');
        var btnTrueEndpoint2 = document.getElementById('btnTrueEndpoint2');

        // Agregar event listeners para los eventos 'click'
        btnTrueEndpoint1.addEventListener('click', function() {
            enviarBooleano(true, "/LaMaria/ingresoDatos/CrearCiclo");            
        });

        btnTrueEndpoint2.addEventListener('click', function() {
            var fechaActual = new Date();
            var options = { year: 'numeric', month: 'long', day: 'numeric' };
            var fechaFormateada = fechaActual.toLocaleDateString('es-ES', options);

            // Actualizar el texto del elemento HTML    
            document.getElementById("fechadefin").textContent = "Fecha fin  de ciclo: " + fechaFormateada;    
            enviarBooleano(true, "/LaMaria/ingresoDatos/FinalizarCiclo"); 
        });

        // Función para enviar el valor booleano al servidor
        function enviarBooleano(valorBooleano, endpoint) {
            // Crear una instancia de XMLHttpRequest
            var xhr = new XMLHttpRequest();

            // Configurar la solicitud POST al servidor
            xhr.open("POST", endpoint, true);
            xhr.setRequestHeader("Content-Type", "application/json");

            // Convertir el valor booleano a JSON y enviarlo
            xhr.send(JSON.stringify({ valor: valorBooleano }));

            // Puedes manejar la respuesta del servidor si es necesario
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log("Respuesta del servidor:", xhr.responseText);
                }
            };
        }
    </script>

    </section>


    <footer id="page-footer">
        <p>&copy; Finca La Marina</p>
    </footer>
    
    <script src="{{url_for('static', path='/js/script.js')}}"></script>
</body>
</html>
